<div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <ng-template #tree let-nodes let-level="level">
            <ul>
                @for (node of nodes; track $index) {
                <li>
                    <div
                        class="folder"
                        [class.active]="node.id === selectedFolderId"
                        [style.paddingLeft.px]="level * 16"
                        (click)="selectFolder(node)"
                    >
                        <div class="icon">
                            @if (node.expanded) {
                            <span>
                                <svg
                                    class="w-4 h-4"
                                    data-slot="icon"
                                    fill="none"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                    aria-hidden="true"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="m19.5 8.25-7.5 7.5-7.5-7.5"
                                    ></path>
                                </svg>
                            </span>
                            } @else {<span class="icon">
                                <svg
                                    class="w-4 h-4"
                                    data-slot="icon"
                                    fill="none"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                    aria-hidden="true"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="m8.25 4.5 7.5 7.5-7.5 7.5"
                                    ></path>
                                </svg> </span
                            >}
                            <span
                                ><svg
                                    class="w-4 h-4 text-yellow-300"
                                    data-slot="icon"
                                    fill="currentColor"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                    aria-hidden="true"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"
                                    ></path></svg></span
                            >&nbsp;
                            <span class="name">
                                {{ node.name }}
                            </span>
                        </div>
                    </div>

                    @if (node.children && node.expanded) {
                    <ng-container>
                        <ng-container
                            *ngTemplateOutlet="
                                tree;
                                context: { $implicit: node.children, level: level + 1 }
                            "
                        >
                        </ng-container> </ng-container
                    >}
                </li>
                }
            </ul>
        </ng-template>

        <ng-container *ngTemplateOutlet="tree; context: { $implicit: folders, level: 0 }">
        </ng-container>
    </aside>

    <!-- CONTENT -->
    <main class="content">
        <table class="file-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Size</th>
                    <th>Type</th>
                    <th>Physical Path</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                @for (file of filesInSelectedFolder; track $index) {
                <tr>
                    <td>{{ file.name }}</td>
                    <td>{{ file.size | number }} bytes</td>
                    <td>{{ file.type }}</td>
                    <td>{{ file.physicalPath }}</td>
                    <td class="action-cell">
                        <button (click)="toggleContextMenu(file.id, $event)">â‹®</button>

                        @if (openedMenuFileId === file.id) {
                        <div class="context-menu">
                            <div (click)="action('Open', file)">Open</div>
                            <div (click)="action('Rename', file)">Rename</div>
                            <div (click)="action('Delete', file)">Delete</div>
                        </div>
                        }
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </main>
</div>
